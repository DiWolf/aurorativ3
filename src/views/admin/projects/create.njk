{% extends "templates/admin.njk" %}
{% block content %}
  {% include "partials/nav_admin.njk" %}
  <div class="container-fluid mt--6">
    <div class="col">
      <div class="card">
        <!-- Card header -->
        <div class="card-header border-0 d-flex justify-content-between align-items-center">
          <h3 class="mb-0">Nuevo Proyecto</h3>
          <a href="/admin/projects" class="btn btn-sm btn-secondary">
            <i class="ni ni-bold-left"></i>
            Volver
          </a>
        </div>
        <!-- Formulario -->
        <div class="card-body">
          {% if error %}
            <div class="alert alert-danger">{{ error }}</div>
          {% endif %}
          {% if success %}
            <div class="alert alert-success">{{ success }}</div>
          {% endif %}
          <form method="post" action="/admin/projects" enctype="multipart/form-data">
            <div class="form-group">
              <label for="client">Cliente</label>
              <input type="text" id="client" name="client" class="form-control" required>
            </div>
            <div class="form-group">
              <label for="title">Título</label>
              <input type="text" id="title" name="title" class="form-control" required>
            </div>
            <div class="form-group">
              <label for="description">Descripción</label>
             <textarea id="description" name="description" rows="6" class="form-control">
  {{ proyecto.description | safe }}
</textarea>
            </div>
            <div class="form-group">
              <label for="resume">Resumen (máx. 255 caracteres)</label>
              <input type="text" id="resume" name="resume" maxlength="255" class="form-control">
              <small class="form-text text-muted">Este texto se mostrará como resumen corto del proyecto.</small>
            </div>
            <div class="form-group">
              <label for="url">URL del Proyecto (opcional)</label>
              <input type="url" id="url" name="url" class="form-control">
            </div>
            <div class="form-group">
              <label for="technologies">Tecnologías</label>
              <select id="technologies" name="technologies[]" class="form-control" multiple>
                {% for tech in technologies %}
                  <option value="{{ tech.id }}">{{ tech.name }}</option>
                {% endfor %}
              </select>
              <small class="form-text text-muted">Mantén presionada CTRL (o CMD en Mac) para seleccionar varias.</small>
            </div>
            <div class="form-group">
              <label for="main_image">Imagen principal</label>
              <input type="file" id="main_image" name="main_image" class="form-control-file">
            </div>
            <div class="form-group">
  <label for="extra_images">Imágenes adicionales</label>
  <input type="file" id="extra_images" name="extra_images" class="form-control-file" multiple>
  <small class="form-text text-muted">Puedes seleccionar varias imágenes (galería del proyecto).</small>
</div>
            <button type="submit" class="btn btn-primary">Guardar</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <!-- En create.njk y edit.njk -->
<script>
  tinymce.init({
    selector: '#description',   // <--- SOLO el textarea de descripción
    plugins: [
      'anchor', 'autolink', 'charmap', 'codesample', 'emoticons',
      'link', 'lists', 'media', 'searchreplace', 'table',
      'visualblocks', 'wordcount', 'checklist', 'mediaembed',
      'casechange', 'formatpainter', 'pageembed', 'a11ychecker',
      'tinymcespellchecker', 'permanentpen', 'powerpaste',
      'advtable', 'advcode', 'advtemplate', 'uploadcare',
      'mentions', 'tinycomments', 'tableofcontents',
      'footnotes', 'mergetags', 'autocorrect', 'typography',
      'inlinecss', 'markdown', 'importword', 'exportword', 'exportpdf'
    ],
    toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | ' +
             'link media table mergetags | addcomment showcomments | ' +
             'spellcheckdialog a11ycheck typography uploadcare | ' +
             'align lineheight | checklist numlist bullist indent outdent | ' +
             'emoticons charmap | removeformat',
    menubar: false,
    branding: false,
    tinycomments_mode: 'embedded',
    tinycomments_author: 'AuroraTI',
    uploadcare_public_key: '9be29f0fa526627d7dca'
  });
</script>

{% endblock %}
